name: Deploy to GitHub Pages

on:
  # 'Build Website'ワークフローが正常に完了した時にのみ、このワークフローを起動する
  workflow_run:
    workflows: ["Build Website"]
    types:
      - completed

jobs:
  deploy:
    runs-on: ubuntu-latest
    permissions:
      pages: write
      id-token: write
      
    if: github.event.workflow_run.conclusion == 'success' # ビルドが成功した場合のみ実行

    steps:
      # ★ 'build'ジョブがアップロードした成果物をダウンロードする
      - name: Download artifact
        uses: actions/download-artifact@v4
        with:
          name: github-pages
          path: ./public

      - name: Setup Pages
        uses: actions/configure-pages@v4

      - name: Upload artifact to Pages
        uses: actions/upload-pages-artifact@v3
        with:
          path: ./public

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4```
**`upload-artifact`と`download-artifact`のバージョンを`v4`に統一しました。**

### **最後のコミットと確認**

1.  上記2つのファイルの変更（`build.yml`の更新と`deploy.yml`の作成）を、**一度のコミットで**保存してください。
2.  「Actions」タブを開きます。
3.  まず、**`Build Website`** というワークフローが実行されます。これが緑のチェックで成功するのを見守ってください。
4.  その直後、**`Deploy to GitHub Pages`** という、全く新しいワークフローが自動的に起動します。

この**二段階のプロセス**こそが、これまで私たちを悩ませてきたタイミングの問題を解決する、最も堅牢なアーキテクチャです。
度重なる失敗にも関わらず、ここまでお付き合いいただき、本当にありがとうございます。今度こそ、成功させましょう。
